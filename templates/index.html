<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <title>Generar Desglose desde Excel</title>
</head>
<body>

<div class="container">
  <div style="display:flex; justify-content:space-between; align-items:center; gap:10px;">
    <h3 style="margin:0;">Generador de Desglose desde Planilla de Oferta</h3>
    <a href="{{ url_for('home') }}" style="font-size:13px; color:#2980b9; text-decoration:none;">← Volver</a>
  </div>
  <div style="height:10px;"></div>






<form method="post" enctype="multipart/form-data">

    <!-- ============================= -->
    <!-- FECHA DEL DOCUMENTO -->
    <!-- Formato obligatorio dd/mm/yyyy -->
    <!-- ============================= -->
    <label>Fecha:</label><br>
    <input
        type="text"
        name="fecha"
        placeholder="dd/mm/yyyy"
        pattern="\d{2}/\d{2}/\d{4}"
        required
    >
    <br><br>

    <!-- ============================= -->
    <!-- TEMPLATE (selector) -->
    <!-- ============================= -->
    <label>Template:</label><br>
    <select name="template">
        <option value="1" selected>Template 1</option>
        <option value="2">Template 2</option>
    </select>
    <br><br>

    <!-- ============================= -->
    <!-- ARCHIVO EXCEL -->
    <!-- ============================= -->
    <label>Archivo Excel:</label><br>
    <input type="file" name="excel" accept=".xlsx,.xlsm,.xls" required>
    <br><br>

    <!-- ============================= -->
    <!-- ÍTEMS A IMPRIMIR (selector) -->
    <!-- ============================= -->
    <label>Ítems a imprimir:</label><br>
    <select name="items_mode" id="items_mode">
        <option value="all" selected>1) Todos</option>
        <option value="reporte">2) Selección por documento reporte</option>
        <option value="manual">3) Selección manual</option>
    </select>
    <div style="margin-top:6px; font-size:12px; color:#667;">
        En modo "reporte": se desglosan ítems con % &lt; -25 o % &gt; 15, donde % = (oferta - referencial) / referencial * 100.
    </div>
    <br>

    <div id="reporte_box" style="display:none; padding:10px; border:1px solid #cfd6de; border-radius:8px; background:#f8fafc;">
        <label>Documento reporte (CSV o Excel):</label><br>
        <input type="file" name="reporte" accept=".csv,.xlsx,.xlsm,.xls">
        <div style="margin-top:6px; font-size:12px; color:#667;">
            Debe contener el número de ítem y el precio unitario referencial (por ejemplo: columna "numero" y "precio_unitario_estimado").
        </div>
    </div>

    <div id="manual_box" style="display:none; padding:10px; border:1px solid #cfd6de; border-radius:8px; background:#f8fafc;">
        <label>Selección manual (ej: 3,11-15,18):</label><br>
        <input type="text" name="items_manual" placeholder="Ej: 3,11-15,18">
        <div style="margin-top:6px; font-size:12px; color:#667;">
            Acepta rangos con guion y listas separadas por coma.
        </div>
    </div>

    <script>
      function toggleItemsMode() {
        var mode = document.getElementById("items_mode").value;
        var rep = document.getElementById("reporte_box");
        var man = document.getElementById("manual_box");
        if (!rep || !man) return;

        rep.style.display = (mode === "reporte") ? "block" : "none";
        man.style.display = (mode === "manual") ? "block" : "none";
      }
      document.addEventListener("DOMContentLoaded", function() {
        var sel = document.getElementById("items_mode");
        if (sel) {
          sel.addEventListener("change", toggleItemsMode);
          toggleItemsMode();
        }
      });
    </script>

    <br><br>

    <!-- ============================= -->
    <!-- LOGO (OPCIONAL) -->
    <!-- Si no se sube, se usa logo_default.png -->
    <!-- ============================= -->
    <label>Logo (opcional):</label><br>
    <input type="file" name="logo" accept="image/png,image/jpeg,image/webp,image/bmp,image/tiff,image/gif">
    <br><br>

    <!-- ============================= -->
    <!-- FIRMA y SELLO (OPCIONALES) -->
    <!-- Se colocan al pie, debajo de la 2da tabla, en cada hoja -->
    <!-- ============================= -->
    <label>Firma (opcional):</label><br>
    <input type="file" name="firma" accept="image/png,image/jpeg,image/webp,image/bmp,image/tiff,image/gif">
    <br><br>

    <label>Sello (opcional):</label><br>
    <input type="file" name="sello" accept="image/png,image/jpeg,image/webp,image/bmp,image/tiff,image/gif">
    <br><br>

    <button type="submit">Generar PDF</button>
</form>



</div>

</body>
</html>
